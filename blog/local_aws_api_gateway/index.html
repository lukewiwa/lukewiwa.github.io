<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Local AWS API Gateway</title><link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"><link rel="stylesheet" href="/index.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark.min.css" media="screen and (prefers-color-scheme: dark)"></head><body><header><nav class="flex flex-row items-center justify-between"><a href="/" class="link nav-brand no-underline dtc w-25 f3">Wiwa</a><div class="dtc v-mid w-75 tr"><a href="/blog" class="link nav-link f6 f5-ns dib mr3 mr4-ns b">Blog</a><a href="/projects" class="link nav-link f6 f5-ns dib mr3 mr4-ns ">Projects</a></div></nav></header><main class="pt-4"><article><h1 class="f2">Local AWS API Gateway</h1><time class="db mb1">2021-02-20</time><div><p>Many smart people both inside and outside of Amazon have been working hard to make local development of AWS lambda functions more accessible. There does however seem to be a missing link to using lambdas as http endpoints.</p>
<!--more-->
<p>There are tools to make AWS lambda functions work locally and also to mock an AWS API Gateway request and response. The most prominent being the <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-using-start-api.html">AWS SAM local commands</a> (interestingly implemented using a local flask server) and the <a href="https://www.serverless.com/plugins/serverless-offline/">serverless framework offline plugins</a> (this one uses a hapi server). They do a pretty good job but it does mean that you have to buy in to the entire ecosystem of those tools. On the other side of the coin AWS has started supporting lambda functions in docker containers and even made <a href="https://docs.aws.amazon.com/lambda/latest/dg/images-test.html">local testing possible</a>.</p>
<p>These tools are great but they definitely become cumbersome if you want to add resources that don't have the requisite plugins. I prefer to use a docker-compose file to run resources locally for testing and there doesn't seem to be any containers that will mock this relationship between API Gateway and lambda functions (tweet me if I'm wrong about this). So I made my own.</p>
<p>I created a <a href="https://hub.docker.com/repository/docker/lukewiwa/local-lambda-api-gateway">AWS API Gateway container</a> to mock a simple HTTP Proxy call. It basically mimics what a default integration will output for you if you were to create this lambda and API Gateway route via clickops. Admittedly this is a real kludge and I'm happy to accept any PRs or issues at the <a href="https://github.com/lukewiwa/local-lambda-api-gateway">github repo</a>. Below is an example of how you might plug this docker container into a docker-compose file.</p>
<pre><code class="language-yaml hljs"><span class="hljs-attr">version:</span> <span class="hljs-string">"3"</span>

<span class="hljs-attr">services:</span>

  <span class="hljs-attr">frontend:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">node</span>
    <span class="hljs-comment"># Extra args</span>

  <span class="hljs-attr">api-gateway:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">local-lambda-api-gateway</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">LAMBDA_HOST:</span> <span class="hljs-string">cloud-function</span>
      <span class="hljs-attr">LAMBDA_PORT:</span> <span class="hljs-number">8080</span>

  <span class="hljs-attr">cloud-function:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">public.ecr.aws/lambda/nodejs</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">/lambda-entrypoint.sh</span> <span class="hljs-string">index.handler</span>
    <span class="hljs-comment"># extra args</span>
</code></pre>
</div></article></main></body></html>