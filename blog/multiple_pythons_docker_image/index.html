<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Docker Image With Multiple Python Installs</title><link rel="stylesheet" href="/index.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css"></head><body class="mid-gray"><header><nav class="flex flex-row items-center justify-between"><a href="/" class="link black hover-gray dtc w-25 f3">Wiwa</a><div class="dtc v-mid w-75 tr"><a href="/blog" class="link gray hover-moon-gray f6 f5-ns dib mr3 mr4-ns b">Blog</a><a href="/projects" class="link gray hover-moon-gray f6 f5-ns dib mr3 mr4-ns ">Projects</a></div></nav></header><main class="pt-4"><div><article><h1 class="f2">Docker Image With Multiple Python Installs</h1><time class="db gray mb1">5/26/2021</time><div><p>Not sure whether this has been done before but I created a <a href="https://hub.docker.com/r/lukewiwa/pythons">docker container with four (4) Python installs</a>. To get there I heavily abused <a href="https://docs.docker.com/develop/develop-images/multistage-build/#use-an-external-image-as-a-stage">Docker multistage builds from external images</a>. You can check out the <a href="https://github.com/lukewiwa/pythons">repo</a> for the gory details. Now I'm not insane there is a specific reason why I did this.</p>
<!--more-->
<p>I'm pretty all in on Visual Studio Code dev containers and I also like having sensible CI pipelines to catch things. I recently wrote a little library that I diligently tested against multiple python versions using <a href="https://tox.readthedocs.io/en/latest/index.html">tox</a>. I like to be able to test and debug this locally and not rely on the pipeline specific syntax. So the challenge was to create an environment locally and in the pipeline where a single <code>tox</code> command would kick start all my tests. This seems to be the solution that satisfies this criteria.</p>
<p>Here's an example using Github Actions:</p>
<pre><code class="language-yaml hljs"><span class="hljs-attr">name:</span> <span class="hljs-string">tests</span>
<span class="hljs-attr">on:</span> <span class="hljs-string">push</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">container:</span>
      <span class="hljs-attr">image:</span> <span class="hljs-string">lukewiwa/pythons:latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tox</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">tox</span>
</code></pre>
<p>And one for bitbucket pipelines:</p>
<pre><code class="language-yaml hljs"><span class="hljs-attr">image:</span> <span class="hljs-string">lukewiwa/pythons</span>

<span class="hljs-attr">pipelines:</span>
  <span class="hljs-attr">default:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">step:</span>
        <span class="hljs-attr">script:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">tox</span>
</code></pre>
</div></article></div></main></body></html>