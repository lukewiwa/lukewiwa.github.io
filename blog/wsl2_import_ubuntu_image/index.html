<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Importing Rootfs Ubuntu Images into WSL2</title><link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"><link rel="stylesheet" href="/index.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github-dark.min.css" media="screen and (prefers-color-scheme: dark)"></head><body><header><nav class="flex flex-row items-center justify-between"><a href="/" class="link nav-brand no-underline dtc w-25 f3">Wiwa</a><div class="dtc v-mid w-75 tr"><a href="/blog" class="link nav-link f6 f5-ns dib mr3 mr4-ns b">Blog</a><a href="/projects" class="link nav-link f6 f5-ns dib mr3 mr4-ns ">Projects</a></div></nav></header><main class="pt-4"><div><article><h1 class="f2">Importing Rootfs Ubuntu Images into WSL2</h1><time class="db gray mb1">5/26/2020</time><div><p>I've been generally impressed with the preview of Windows Subsystem for Linux 2 (WSL2) and it's integration between the windows desktop and the underlying linux kernel.</p>
<!--more-->
<p>I did notice on a <a href="https://www.youtube.com/watch?v=UCAid-NQwWU&amp;feature=youtu.be">talk by one of the main devs</a> that you could manually import and export linux and container images. This seemed like a nice idea if you wanted to separate dev environments or perhaps have separate work or personal accounts. The demonstration showed exporting and importing docker containers and linux tarballs using the Cool New <code>wsl</code> command in powershell. My dilemma was that I had already setup one Ubuntu environment and wanted a clean one from scratch. So I did a little digging and managed to get one working with a few hiccups along the way.</p>
<h1>1. Download The Latest Rootfs Image</h1>
<p>The Ubuntu wiki has a very neat <a href="https://wiki.ubuntu.com/WSL#Installing_Ubuntu_on_WSL_via_rootfs">guide</a> on how to import an image. Be sure to download the nightly image with the <code>-wsl.rootfs.tar.gz</code> suffix.</p>
<h1>2. Import The Image</h1>
<p>As in the Ubuntu wiki run the command below. I decided to keep the image location in my home directory, in a <code>distro</code> folder.</p>
<pre><code class="language-shell hljs">wsl --import &lt;DistributionName&gt; &lt;InstallLocation&gt; &lt;FileName&gt;
</code></pre>
<h1>3. Create A User</h1>
<p>Drop into the wsl2 instance by running the name of the distribution as a command in powershell, or by using the excellent new Windows Terminal app. By default the only user in the image is the root user. While the stock standard Ubuntu image you install from the Microsoft Store prompts you to create a user at startup we'll have to do the prompting ourselves here. The <code>adduser</code> command should get you what you need. <strong>Be sure to add your new user to the sudo group</strong>.</p>
<pre><code class="language-shell hljs">adduser &lt;username&gt; --ingroup sudo
</code></pre>
<h1>4. Change The Default User</h1>
<p>Now that we have created the user we would like it to be the default user whenever you start a new shell. This is a little tricky and there's a <a href="https://github.com/Microsoft/WSL/issues/3974">github issue</a> outlining this pain point and some possible work arounds. I went with the powershell option but pick your poison.</p>
<p>And that's it, enjoy separating those concerns.</p>
</div></article></div></main></body></html>